<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>图谱迭代</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6">
<div class="max-w-2xl mx-auto">
    <h2 class="text-xl font-bold mb-4">图谱迭代配置</h2>

    <div class="mb-6">
        <label class="block text-gray-700 mb-2" for="prompt">Prompt 输入</label>
        <textarea id="prompt"
                  placeholder="请输入用于图谱迭代的 Prompt..."
                  class="w-full h-32 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
    </div>

    <div class="mb-6">
        <label class="block text-gray-700 mb-2">上传图片文件夹（支持多选）</label>
        <input type="file"
               id="folderUpload"
               webkitdirectory directory multiple
               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
    </div>

    <button onclick="submitIteration()" class="py-2 px-6 bg-blue-600 text-white rounded hover:bg-blue-700">
        提交
    </button>

    <a href="index.html" class="ml-4 text-gray-600 hover:underline">← 返回</a>
</div>
</body>
</html>

<script>
  async function submitIteration() {
    const prompt = document.getElementById("prompt").value;
    const files = document.getElementById("folderUpload").files;
    if (!prompt || files.length === 0) {
      alert("请填写 Prompt 并选择图片文件夹");
      return;
    }

    const formData = new FormData();
    formData.append("prompt", prompt);
    for (let i = 0; i < files.length; i++) {
      formData.append("images", files[i]);
    }

    try {
      const resp = await fetch("/iterate", {
        method: "POST",
        body: formData,
      });
      const result = await resp.json();
      alert("任务完成！" + (result.message || ""));
    } catch (err) {
      console.error(err);
      alert("提交失败：" + err.message);
    }
  }
</script>