<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å›¾ç‰‡è¯†åˆ«</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 p-6">
  <div class="max-w-2xl mx-auto">
    <h2 class="text-xl font-bold mb-4">AIGC å›¾ç‰‡çœŸå®æ€§è¯†åˆ«</h2>

    <input type="file"
           id="imageFile"
           accept="image/*"
           class="mb-4 block w-full text-sm text-gray-500
                  file:mr-4 file:py-2 file:px-4 file:rounded
                  file:border-0 file:text-sm file:font-semibold
                  file:bg-green-50 file:text-green-700 hover:file:bg-green-100" />

    <!-- æ¶ˆæ¯ä¸ç»“æœåŒºåŸŸ -->
    <div id="messageChain"
         class="mt-6 space-y-2 min-h-[120px] border border-gray-200 rounded p-4 bg-white text-sm">
    </div>

    <a href="index.html" class="mt-4 inline-block text-gray-600 hover:underline">â† è¿”å›</a>
  </div>

<script>
const container = document.getElementById("messageChain");
const fileInput = document.getElementById("imageFile");

function addMessage(text, type = "info") {
  const div = document.createElement("div");
  div.className =
    type === "result"
      ? "p-2 bg-green-50 border border-green-200 rounded"
      : "p-2 bg-gray-100 rounded";
  div.textContent = text;
  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
}

fileInput.addEventListener("change", async function (event) {
  const file = event.target.files[0];
  if (!file) return;

  container.innerHTML = "";

  // è¿‡ç¨‹æç¤º
  addMessage("ğŸ“¤ å›¾ç‰‡ä¸Šä¼ æˆåŠŸ");
  addMessage("ğŸ” æ­£åœ¨æå–å›¾åƒç‰¹å¾...");
  addMessage("ğŸ§  æ­£åœ¨è¿›è¡Œå›¾è°±é©±åŠ¨æ¨ç†...");

  const formData = new FormData();
  formData.append("image", file);

  try {
    const response = await fetch("/api/aigc/detect", {
      method: "POST",
      body: formData
    });

    const data = await response.json();

    // === æœ€ç»ˆç»“æœ ===
    addMessage(
      `âœ… åˆ¤å®šç»“æœï¼š${data.label}ï¼ˆç½®ä¿¡åº¦ ${data.confidence}ï¼‰`,
      "result"
    );

    // === è¯æ®å­åŸŸ ===
    addMessage("ğŸ”— æ¿€æ´»çš„çŸ¥è¯†å›¾è°±è¯æ®ï¼š");
    data.evidence.forEach(e => {
      addMessage(
        `â€¢ ${e.subdomain}ï¼ˆ${e.domain}ï¼Œscore=${e.score}ï¼‰`
      );
    });

    // === æ¨ç†è§£é‡Š ===
    addMessage("ğŸ§  å¤§æ¨¡å‹æ¨ç†è¯´æ˜ï¼š");
    data.reasoning.explanations.forEach(exp => {
      addMessage(exp);
    });

    // === è¯æ®é“¾ ===
    addMessage("ğŸ“ è¯æ®é“¾ï¼š");
    data.reasoning.evidence_chain.forEach(chain => {
      addMessage(chain);
    });

  } catch (err) {
    addMessage("âŒ è¯†åˆ«å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡", "result");
    console.error(err);
  }
});
</script>

</body>
</html>
