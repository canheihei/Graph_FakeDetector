<!DOCTYPE html>
<html lang="zh-CN" class="h-full bg-gray-100">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>AIGC æ·±åº¦ä¼ªé€ æ£€æµ‹ - GraphXFlow</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // é…ç½® Tailwind CDN ä»¥åŒ¹é…æˆ‘ä»¬é€‰å®šçš„ Indigo ä¸»é¢˜è‰²
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        indigo: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81', },
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'], },
                }
            }
        }
    </script>
    <style>
        /* æ²¿ç”¨ä¸Šä¸€ä¸ªé¡µé¢çš„è‡ªå®šä¹‰åŠ¨ç”»æ ·å¼ */
        .fade-in-up { opacity: 0; transform: translateY(15px); transition: opacity 0.4s ease-out, transform 0.4s ease-out; }
        .fade-in-up.show { opacity: 1; transform: translateY(0); }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-custom { animation: spin 1s linear infinite; }
        /* ç”¨äºæµç¨‹æ­¥éª¤çš„è¿‡æ¸¡åŠ¨ç”» */
        .step-item { transition: all 0.3s ease-in-out; }
    </style>
</head>

<body class="bg-gray-100 min-h-screen py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto space-y-8 fade-in-up">
        <div class="text-center">
             <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight sm:text-4xl">
                AIGC <span class="text-indigo-600">å›¾åƒçœŸå®æ€§å›¾è°±è¯†åˆ«</span>
            </h1>
            <p class="mt-3 text-lg text-gray-500">
                ä¸Šä¼ å¯ç–‘å›¾åƒï¼Œåˆ©ç”¨å¤šæ¨¡æ€çŸ¥è¯†å›¾è°±è¿›è¡Œæ·±åº¦ç‰¹å¾æ¯”å¯¹ä¸æº¯æºåˆ†æã€‚
            </p>
        </div>

        <section class="bg-white shadow-xl rounded-xl overflow-hidden transition-all duration-300 hover:shadow-2xl fade-in-up delay-100">
            <div class="p-8 border-b border-gray-100">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <span class="flex items-center justify-center w-8 h-8 bg-indigo-100 text-indigo-600 rounded-full mr-3">1</span>
                    å›¾åƒæ•°æ®è¾“å…¥
                </h2>
                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-indigo-400 transition-colors duration-200 bg-gray-50">
                    <div class="space-y-1 text-center">
                        <svg class="mx-auto h-12 w-12 text-indigo-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-4V24m-4 4v4H12m4 0h8m-8-4h.01M16 12h.01M24 12h.01M28 12h.01M16 16h.01M24 16h.01M28 16h.01M16 20h.01M24 20h.01M28 20h.01" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <div class="flex text-sm text-gray-600 justify-center">
                            <label for="imageFile" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500 p-1">
                                <span>ç‚¹å‡»é€‰æ‹©å›¾åƒæ–‡ä»¶</span>
                                <input id="imageFile" type="file" accept="image/*" class="sr-only">
                            </label>
                            <p class="pl-1 self-center">æˆ–æ‹–æ‹½è‡³æ­¤</p>
                        </div>
                        <p class="text-xs text-gray-500">æ”¯æŒ JPG, PNG, WebP ç­‰å¸¸è§æ ¼å¼ã€‚</p>
                    </div>
                </div>
            </div>

            <div id="analysisSection" class="hidden p-8 bg-gray-50">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <span class="flex items-center justify-center w-8 h-8 bg-indigo-100 text-indigo-600 rounded-full mr-3">2</span>
                    å›¾è°±æ¨ç†å·¥ä½œæµ
                </h2>

                <div id="workflowSteps" class="space-y-3 mb-8">
                    </div>

                <div id="finalResultCard" class="hidden fade-in-up">
                    <div id="verdictBanner" class="p-4 rounded-t-lg bg-indigo-600 text-white flex items-center justify-between">
                        <div class="flex items-center">
                            <svg class="w-8 h-8 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <h3 class="text-xl font-bold" id="resultLabel">åˆ†æå®Œæˆ</h3>
                        </div>
                        <span class="text-indigo-100 bg-indigo-700 px-3 py-1 rounded-full text-sm font-medium">ç½®ä¿¡åº¦: <span id="resultConfidence"></span></span>
                    </div>

                    <div class="bg-white border border-t-0 border-gray-200 rounded-b-lg p-6 space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="flex items-center text-md font-semibold text-gray-800 mb-3">
                                    <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                    æ¿€æ´»å›¾è°±è¯æ®åŸŸ
                                </h4>
                                <ul id="evidenceList" class="space-y-2 text-sm text-gray-600 bg-indigo-50 p-3 rounded-lg"></ul>
                            </div>
                            <div>
                                <h4 class="flex items-center text-md font-semibold text-gray-800 mb-3">
                                    <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M17.636 19.364l-.707-.707M12 21v-1M6.364 19.364l.707-.707M3 12h1M6.364 4.636l.707.707"></path></svg>
                                    æ ¸å¿ƒæ¨ç†ä¾æ®
                                </h4>
                                <ul id="reasoningList" class="space-y-2 text-sm text-gray-600 bg-gray-100 p-3 rounded-lg"></ul>
                            </div>
                        </div>

                         <div>
                             <h4 class="flex items-center text-md font-semibold text-gray-800 mb-3">
                                <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
                                å®Œæ•´æ¨ç†è¯æ®é“¾
                            </h4>
                            <div id="evidenceChainBox" class="text-sm text-gray-700 bg-gray-50 border border-gray-200 p-4 rounded-lg font-mono overflow-x-auto">
                            </div>
                        </div>
                    </div>
                </div> </div>
        </section>

        <div class="text-center fade-in-up delay-200">
            <a href="index.html" class="inline-flex items-center text-indigo-600 hover:text-indigo-800 transition-colors font-medium">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                è¿”å›æ§åˆ¶å°ä¸»é¡µ
            </a>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.fade-in-up').forEach(el => el.classList.add('show'));
});

const fileInput = document.getElementById("imageFile");
const analysisSection = document.getElementById("analysisSection");
const workflowStepsContainer = document.getElementById("workflowSteps");
const finalResultCard = document.getElementById("finalResultCard");

// ç”¨äºåˆ›å»ºä¸€ä¸ªçœ‹èµ·æ¥å¤æ‚çš„æµç¨‹æ­¥éª¤ UI
function createWorkflowStepUI(text, status = 'pending') {
    const stepId = 'step-' + Date.now();
    let iconHtml = '';
    let bgColor = 'bg-white';
    let textColor = 'text-gray-500';
    let borderColor = 'border-gray-200';

    if (status === 'loading') {
        iconHtml = `<svg class="animate-spin-custom h-5 w-5 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
        bgColor = 'bg-indigo-50';
        textColor = 'text-indigo-700';
        borderColor = 'border-indigo-200';
    } else if (status === 'success') {
        iconHtml = `<svg class="h-5 w-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
        bgColor = 'bg-green-50';
        textColor = 'text-gray-700';
        borderColor = 'border-green-200';
    }

    const stepHtml = `
        <div id="${stepId}" class="step-item flex items-center p-3 ${bgColor} border ${borderColor} rounded-lg shadow-sm fade-in-up show">
            <div class="flex-shrink-0 mr-3">
                ${iconHtml}
            </div>
            <div class="flex-grow font-medium ${textColor}">
                ${text}
            </div>
        </div>
    `;
    workflowStepsContainer.insertAdjacentHTML('beforeend', stepHtml);
    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
    workflowStepsContainer.scrollTop = workflowStepsContainer.scrollHeight;
    return stepId;
}

// æ›´æ–°ç‰¹å®šæ­¥éª¤çš„çŠ¶æ€
function updateStepStatus(stepId, status) {
    const stepEl = document.getElementById(stepId);
    if (!stepEl) return;
    // è¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œç›´æ¥æ›¿æ¢æ•´ä¸ªå…ƒç´ çš„å†…å®¹æ¥æ›´æ–°çŠ¶æ€
    // å®é™…åº”ç”¨ä¸­å¯ä»¥æ›´ç²¾ç»†åœ°æ“ä½œ DOM
    const text = stepEl.querySelector('.flex-grow').innerText;
    stepEl.outerHTML = createWorkflowStepUI(text, status).replace('workflowStepsContainer.insertAdjacentHTML(\'beforeend\', stepHtml);', '');
}


fileInput.addEventListener("change", async function (event) {
  const file = event.target.files[0];
  if (!file) return;

  // 1. UI çŠ¶æ€é‡ç½®
  analysisSection.classList.remove("hidden");
  finalResultCard.classList.add("hidden");
  workflowStepsContainer.innerHTML = ""; // æ¸…ç©ºæ—§æ­¥éª¤
  // å¹³æ»‘æ»šåŠ¨åˆ°åˆ†æåŒºåŸŸ
  analysisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

  const formData = new FormData();
  formData.append("image", file);

  try {
    // === æ¨¡æ‹Ÿå¤æ‚çš„åˆ†æè¿‡ç¨‹ UI ===
    // æ­¥éª¤ 1: ä¸Šä¼ 
    createWorkflowStepUI("ğŸ“¤ å›¾åƒå®‰å…¨ä¸Šä¼ è‡³åˆ†ææœåŠ¡å™¨...", 'success');
    await new Promise(r => setTimeout(r, 500)); // æ¨¡æ‹Ÿå»¶æ—¶

    // æ­¥éª¤ 2: ç‰¹å¾æå– (æ˜¾ç¤ºåŠ è½½ä¸­)
    const step2Id = createWorkflowStepUI("ğŸ” æ­£åœ¨è¿›è¡Œå¤šå°ºåº¦è§†è§‰ç‰¹å¾æå–...", 'loading');
    await new Promise(r => setTimeout(r, 1500)); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ

    // æ­¥éª¤ 3: å›¾è°±æ¨ç† (æ›´æ–°æ­¥éª¤2ä¸ºå®Œæˆï¼Œæ˜¾ç¤ºæ­¥éª¤3åŠ è½½ä¸­)
    // ç®€å•çš„ DOM æ“ä½œæ¥æ›¿æ¢çŠ¶æ€å›¾æ ‡ï¼ˆå®é™…é¡¹ç›®ä¸­å¯ä»¥ç”¨æ›´ä¼˜é›…çš„æ–¹å¼ï¼‰
    document.getElementById(step2Id).querySelector('.flex-shrink-0').innerHTML = `<svg class="h-5 w-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
    document.getElementById(step2Id).classList.replace('bg-indigo-50', 'bg-green-50');
    document.getElementById(step2Id).classList.replace('border-indigo-200', 'border-green-200');


    const step3Id = createWorkflowStepUI("ğŸ§  æ¥å…¥ GraphX çŸ¥è¯†å›¾è°±è¿›è¡Œå…³è”æ¨ç†...", 'loading');

    // === å‘èµ·çœŸå®è¯·æ±‚ ===
    // æ³¨æ„ï¼šä¸ºäº†æ¼”ç¤º UI æ•ˆæœï¼Œä¸Šé¢çš„ setTimeout æ˜¯æ¨¡æ‹Ÿçš„ã€‚
    // åœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½éœ€è¦åœ¨ fetch çš„ä¸åŒé˜¶æ®µè°ƒç”¨æ›´æ–° UI çš„å‡½æ•°ã€‚
    // å¦‚æœåç«¯å¾ˆå¿«è¿”å›ï¼Œä¸Šé¢çš„åŠ¨ç”»å¯èƒ½ä¼šä¸€é—ªè€Œè¿‡ã€‚
    const response = await fetch("/api/aigc/detect", {
      method: "POST",
      body: formData
    });

    const data = await response.json();

    // æ›´æ–°æ­¥éª¤ 3 ä¸ºå®Œæˆ
    document.getElementById(step3Id).querySelector('.flex-shrink-0').innerHTML = `<svg class="h-5 w-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
     document.getElementById(step3Id).classList.replace('bg-indigo-50', 'bg-green-50');
     document.getElementById(step3Id).classList.replace('border-indigo-200', 'border-green-200');


    // æ­¥éª¤ 4: ç”ŸæˆæŠ¥å‘Š
    createWorkflowStepUI("âœ… æ¨ç†å®Œæˆï¼Œæ­£åœ¨ç”Ÿæˆåˆ†ææŠ¥å‘Š...", 'success');
    await new Promise(r => setTimeout(r, 600));


    // === æ¸²æŸ“æœ€ç»ˆç»“æœ ===
    // 1. å¡«å……æ•°æ®
    document.getElementById('resultLabel').textContent = data.label || "æœªçŸ¥ç»“æœ";
    document.getElementById('resultConfidence').textContent = data.confidence || "N/A";

    // æ ¹æ®ç»“æœæ”¹å˜ Banner é¢œè‰² (å¯é€‰ï¼Œä¾‹å¦‚çœŸå®ä¸ºç»¿ï¼Œä¼ªé€ ä¸ºçº¢)
    const verdictBanner = document.getElementById('verdictBanner');
    if (data.label && data.label.includes("çœŸå®")) {
        verdictBanner.classList.replace('bg-indigo-600', 'bg-green-600');
        verdictBanner.querySelector('span').classList.replace('bg-indigo-700', 'bg-green-700');
        verdictBanner.querySelector('span').classList.replace('text-indigo-100', 'text-green-100');
    } else if (data.label && data.label.includes("ä¼ªé€ ")) {
        verdictBanner.classList.replace('bg-indigo-600', 'bg-red-600');
        verdictBanner.querySelector('span').classList.replace('bg-indigo-700', 'bg-red-700');
        verdictBanner.querySelector('span').classList.replace('text-indigo-100', 'text-red-100');
    }


    // 2. æ¸²æŸ“åˆ—è¡¨
    const evidenceList = document.getElementById('evidenceList');
    evidenceList.innerHTML = data.evidence.map(e => `<li class="flex justify-between"><span>${e.subdomain} <span class="text-xs text-gray-500">(${e.domain})</span></span> <span class="font-mono text-indigo-700">Score: ${e.score}</span></li>`).join('');

    const reasoningList = document.getElementById('reasoningList');
    reasoningList.innerHTML = data.reasoning.explanations.map(exp => `<li class="flex items-start"><svg class="h-4 w-4 text-indigo-400 mt-1 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg><span>${exp}</span></li>`).join('');

    const evidenceChainBox = document.getElementById('evidenceChainBox');
    // ç”¨ç®­å¤´è¿æ¥è¯æ®é“¾ï¼Œçœ‹èµ·æ¥æ›´åƒä¸€ä¸ªå›¾è°±è·¯å¾„
    evidenceChainBox.innerHTML = data.reasoning.evidence_chain.join(' <span class="text-indigo-400 mx-2">â†’</span> ');


    // 3. æ˜¾ç¤ºç»“æœå¡ç‰‡
    finalResultCard.classList.remove("hidden");
    void finalResultCard.offsetWidth; // è§¦å‘é‡ç»˜
    finalResultCard.classList.add("show");
    // æ»šåŠ¨åˆ°ç»“æœå¡ç‰‡
    finalResultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });


  } catch (err) {
    createWorkflowStepUI("âŒ åˆ†ææµç¨‹ä¸­æ–­ï¼šåç«¯æœåŠ¡å¼‚å¸¸", 'error'); // ä½ éœ€è¦å®ç° 'error' çŠ¶æ€çš„æ ·å¼
    console.error(err);
    alert("è¯†åˆ«å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—æˆ–ç¨åé‡è¯•ã€‚");
  }
});
</script>

</body>
</html>