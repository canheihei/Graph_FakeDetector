<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>图谱数据可视化</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 p-6">
  <div class="max-w-4xl mx-auto">
    <h2 class="text-xl font-bold mb-4">知识图谱统计可视化</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- 节点类型分布 -->
      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-2">节点类型分布</h3>
        <ul id="nodeStats" class="space-y-1 text-sm text-gray-700">
          <li class="text-gray-400">加载中...</li>
        </ul>
      </div>

      <!-- 关系类型分布 -->
      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-2">关系类型分布</h3>
        <ul id="relationStats" class="space-y-1 text-sm text-gray-700">
          <li class="text-gray-400">加载中...</li>
        </ul>
      </div>

      <!-- 域结构 -->
      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-2">域 → 子域结构</h3>
        <ul id="domainStats" class="space-y-1 text-sm text-gray-700">
          <li class="text-gray-400">加载中...</li>
        </ul>
      </div>

      <!-- 图谱整体规模 -->
      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-2">图谱整体规模</h3>
        <ul id="graphOverview" class="space-y-1 text-sm text-gray-700">
          <li class="text-gray-400">加载中...</li>
        </ul>
      </div>

      <!-- 子域列表 -->
      <div class="bg-white p-4 rounded shadow md:col-span-2">
        <h3 class="font-semibold mb-2">已建子域列表</h3>
        <div id="subdomainList" class="flex flex-wrap gap-2 text-sm">
          <span class="text-gray-400">加载中...</span>
        </div>
      </div>

    </div>

    <a href="index.html" class="mt-6 inline-block text-gray-600 hover:underline">← 返回</a>
  </div>

<script>
async function loadGraphStats() {
  try {
    const res = await fetch("/api/graph/stats");
    const data = await res.json();

    // 节点统计
    const nodeStats = document.getElementById("nodeStats");
    nodeStats.innerHTML = "";
    data.node_counts.forEach(n => {
      nodeStats.innerHTML += `<li>• ${n.label}: <strong>${n.count}</strong></li>`;
    });

    // 关系统计
    const relationStats = document.getElementById("relationStats");
    relationStats.innerHTML = "";
    data.relation_counts.forEach(r => {
      relationStats.innerHTML += `<li>• ${r.type}: <strong>${r.count}</strong></li>`;
    });

    // 域结构
    const domainStats = document.getElementById("domainStats");
    domainStats.innerHTML = "";
    data.domain_structure.forEach(d => {
      domainStats.innerHTML += `<li>• ${d.domain}: ${d.sub_count} 个子域</li>`;
    });

    // 图谱规模
    const graphOverview = document.getElementById("graphOverview");
    graphOverview.innerHTML = `
      <li>节点总数：<strong>${data.graph_overview.nodes}</strong></li>
      <li>关系总数：<strong>${data.graph_overview.relations}</strong></li>
    `;

    // 子域列表
    const subdomainList = document.getElementById("subdomainList");
    subdomainList.innerHTML = "";
    data.subdomain_list.forEach(s => {
      subdomainList.innerHTML += `
        <span class="px-2 py-1 bg-blue-50 border border-blue-200 rounded">
          ${s.name}
        </span>`;
    });

  } catch (e) {
    console.error(e);
  }
}

loadGraphStats();
</script>

</body>
</html>
